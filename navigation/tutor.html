---
layout: base
title: Tutor
description: Personalized Tutor All Classes
hide: false 
menu: nav/index.md
permalink: /nolanbot/
---

<style>
  .chat-container {
    width: 100%;
    max-width: 600px;
    margin: 50px auto;
    background: #0E0B00;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }
  .chat-header {
    background: #BE6800;
    color: #FFFFFF;
    padding: 15px;
    text-align: center;
    font-size: 1.2em;
    font-weight: bold;
  }
  #chat-box {
    height: 400px;
    overflow-y: auto;
    padding: 20px;
    background: #F9F9F9;
    border-bottom: 1px solid #0E0202;
  }
  .chat-input {
    display: flex;
    align-items: center;
    padding: 10px;
    background: #F0F0F0;
  }
  #question {
    flex: 1;
    padding: 10px;
    font-size: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  #send-btn {
    background: #FFFFFF;
    color: rgb(255, 255, 255);
    border: none;
    padding: 10px 15px;
    margin-left: 10px;
    font-size: 1em;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
  }
  #send-btn:hover {
    background: #005F93;
  }
  /* Chat Message Styles */
  .chat-message {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 8px;
  }
  .chat-message.user {
    background: rgba(234, 238, 241, 0.941);
    color: #B36200;
    text-align: left;
  }
  .chat-message.bot {
    background: #BE6800;
    color: white;
    text-align: left;
  }
</style>
<div class="chat-container">
  <div class="chat-header">HomeworkBot</div>
  <div id="chat-box"></div>
  <div class="chat-input">
    <input type="text" id="question" placeholder="Type your message here..." />
    <button id="send-btn">Send</button>
  </div>
</div>
<script>
  var pythonURI;
  if (location.hostname === "localhost") {
    pythonURI = "http://localhost:8202";
  } else if (location.hostname === "127.0.0.1") {
    pythonURI = "http://127.0.0.1:8202";
  } else {
    pythonURI = "https://flocker.nighthawkcodingsociety.com";
  }
  
  const fetchOptions = {
    method: "GET",
    mode: "cors",
    cache: "default",
    credentials: "include",
    headers: {
      "Content-Type": "application/json",
      "X-Origin": "client",
    },
  };
  async function deleteQ(question) {
    const response = await fetch(`${pythonURI}/api/ai/delete`, {
      ...fetchOptions,
      method: "DELETE",
      body: JSON.stringify({ question }),
    });
    const data = await response.json();
    if (data.error) {
      alert(data.error);
      return;
    }
    // Find and remove both question and response divs
    const questionDiv = document.querySelector(`div[data-q="${question}"]`);
    const responseDiv = questionDiv?.nextElementSibling; // Response is usually the next sibling
    if (questionDiv) questionDiv.remove();
    if (responseDiv) responseDiv.remove();
  }
  async function updateQ(oldQuestion) {
    const newQuestion = prompt("Enter the updated question:");
    if (!newQuestion) {
        alert("Update canceled: No new question provided.");
        return;
    }
    try {
        // Send the old and new questions to the backend
        const response = await fetch(`${pythonURI}/api/ai/update`, {
            ...fetchOptions,
            method: "PUT",
            body: JSON.stringify({ oldQuestion, newQuestion }),
        });
        const data = await response.json();
        if (data.error) {
            alert(`Error: ${data.error}`);
            return;
        }
        // Get the new response generated by the backend
        const updatedResponse = data.response;
        // Dynamically update the frontend with the new question and response
        const questionDiv = document.querySelector(
            `div[data-q="${oldQuestion}"]`
        );
        if (questionDiv) {
            // Update the question in the DOM
            questionDiv.querySelector(".question-text").innerText = newQuestion;
            questionDiv.setAttribute("data-q", newQuestion);
            questionDiv.querySelector("button[onclick^='deleteQ']").setAttribute(
                "onclick",
                `deleteQ('${newQuestion}')`
            );
            questionDiv.querySelector("button[onclick^='updateQ']").setAttribute(
                "onclick",
                `updateQ('${newQuestion}')`
            );
        }
        const responseDiv = document.querySelector(
            `div[data-r="${oldQuestion}"]`
        );
        if (responseDiv) {
            // Update the response in the DOM
            responseDiv.querySelector(".response-text").innerText = updatedResponse;
            responseDiv.setAttribute("data-r", newQuestion);
        }
        alert("Update successful!");
    } catch (error) {
        console.error("Error updating the question and response:", error);
        alert("An error occurred while updating. Please try again.");
    }
}
async function sendQuestion(question) {
  const chatBox = document.getElementById("chat-box");
  chatBox.innerHTML += `
      <div data-q="${question}" style="margin-bottom: 20px; background: rgba(232, 244, 255, 0.85); padding: 15px; border-radius: 8px;">
          <strong style="color: #0056B3;">You:</strong>
          <span style="color: #0056B3;" class="question-text">${question}</span>
          <button onclick="deleteQ('${question}')">Delete</button>
          <button onclick="updateQ('${question}')">Update</button>
      </div>`;

  try {
      const response = await fetch(`${pythonURI}/api/ai/help`, {
          ...fetchOptions,
          method: "POST",
          body: JSON.stringify({ question }),
      });

      if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
      }

      const data = await response.json();
      console.log("Response from backend:", data);

      const aiResponse = data.response || "Error: Unable to fetch response.";
      chatBox.innerHTML += `
          <div data-r="${question}" style="margin-bottom: 20px; background: #0077BE; padding: 15px; border-radius: 8px; color: white;">
              <strong>Cantella:</strong>
              <span class="response-text">${aiResponse}</span>
          </div>`;
  } catch (error) {
      console.error("Error fetching response:", error);
      chatBox.innerHTML += `
          <div style="color: red; margin-top: 10px;">
              Error: Unable to connect to the server. Please try again later.
          </div>`;
  }

  document.getElementById("question").value = "";
  chatBox.scrollTop = chatBox.scrollHeight;
}


// Fetch all stored questions and responses from the backend
async function fetchAllLogs() {
  const chatBox = document.getElementById("chat-box");
  chatBox.innerHTML = ""; // Clear existing chat logs
  try {
      const response = await fetch(`${pythonURI}/api/ai/logs`, {
          ...fetchOptions,
          method: "GET",
      });
      const logs = await response.json();
      if (logs.error) {
          alert(`Error fetching logs: ${logs.error}`);
          return;
      }
      // Populate the frontend with the fetched logs
      logs.forEach((log) => {
          const { question, response } = log;
          // Add question to the chat box
          chatBox.innerHTML += `
              <div data-q="${question}" style="margin-bottom: 20px; background: rgba(232, 244, 255, 0.85); padding: 15px; border-radius: 8px;">
                  <strong style="color: #0056B3;">You:</strong>
                  <span style="color: #0056B3;" class="question-text">${question}</span>
                  <button onclick="deleteQ('${question}')">Delete</button>
                  <button onclick="updateQ('${question}')">Update</button>
              </div>`;
          // Add response to the chat box
          chatBox.innerHTML += `
              <div data-r="${question}" style="margin-bottom: 20px; background: #0077BE; padding: 15px; border-radius: 8px; color: white;">
                  <strong>Poseidon:</strong>
                  <span class="response-text">${response}</span>
              </div>`;
      });
  } catch (error) {
      console.error("Error fetching logs:", error);
      alert("Failed to fetch logs. Please try again.");
  }
}
// Call fetchAllLogs on page load
window.onload = fetchAllLogs;

</script>
<!-- Optional CSS -->
<style>
  /* Chatbox Scrollbar Styling */
  #chat-box::-webkit-scrollbar {
    width: 8px;
  }
  #chat-box::-webkit-scrollbar-thumb {
    background: #b35a00;
    /* Match header and footer */
    border-radius: 5px;
  }
  /* Button Hover Effect */
  button:hover {
    background-color: #be7200;
    color: white;
  }
</style>
